"data/cedefop_skills_ovate_skill_demand/csv/05_esco_skill_skill_across_occupations_hyper",
full.names = TRUE
) %>%
map(function(file_name) {
date <- str_extract(file_name, "\\d{4}_q\\d{1}") %>%
str_replace("_q1", "-03-31") %>%
str_replace("_q2", "-06-30") %>%
str_replace("_q3", "-09-30") %>%
str_replace("_q4", "-12-31") %>%
as.Date()
data <- read_csv(file_name)
data <- data %>%
mutate(dmax = date, dmin = date - months(12))
data
}) %>%
bind_rows() %>%
mutate(
idcountry = ifelse(
is.na(idcountry),
countryset,
idcountry
)
) %>%
select(-countryset)
ai_exposure <- read_ai_exposure_file(
"data/ai_exposure_scores/scored_esco_occupations_matched.csv",
level = 2
)
ai_exposure_l3 <- read_ai_exposure_file(
"data/ai_exposure_scores/scored_esco_occupations_matched.csv",
level = 3
)
# Calculate correlation matrix
l3_exposure_correlation <- ai_exposure_l3 %>%
select(
ai_product_exposure_score,
felten_exposure_score,
webb_exposure_score,
beta_eloundou
) %>%
cor(use = "complete.obs")
# Create correlation plot using corrplot
l3_exposure_plot <- corrplot::corrplot(l3_exposure_correlation,
method = "color",
type = "upper",
order = "hclust",
addCoef.col = "black",
tl.col = "black",
tl.srt = 45,
diag = FALSE,
number.cex = 0.8,
tl.cex = 0.8
)
PerformanceAnalytics::chart.Correlation(
ai_exposure_l3 %>%
select(
"Demirev 2024" = ai_product_exposure_score,
"Felten et al 2018" = felten_exposure_score,
"Webb 2022" = webb_exposure_score,
"Eloundou et al 2023" = beta_eloundou
) %>%
na.omit(),
histogram = TRUE,
pch = 19
)
oja_twfe <- format_twfe_oja_data(oja, ai_exposure, level = 2)
oja_twfe_l3 <- format_twfe_oja_data(oja_l3, ai_exposure_l3, level = 3)
oja_l3_twfe <- oja_l3 %>%
rename(
idesco_level_2 = idesco_level_3,
esco_level_2_short = esco_level_3
) %>%
format_twfe_oja_data(
ai_exposure_l3 %>%
rename(
isco_level_2 = isco_level_3
)
) %>%
rename(
esco_level_3_short = esco_level_2_short,
idesco_level_3 = idesco_level_2
) # the function expects level 2, so rename isntead of rewriting it
#skills_total <-
skills %>%
filter(idcountry == "EU27_2020 + UK") %>%
filter(esco_hier_level_0 == "skills")
skills %>%
select(
dmax, idcountry, idesco_level_3, esco_hier_level_0,
esco_hier_level_1, esco_hier_level_2, esco_hier_level_3,
mentions = Mention_hier
) %>%
filter(
esco_hier_level_0 == "skills"
) %>%
filter(
!str_detect(idcountry, "EU2")
) %>%
mutate(
idesco_level_2 = substr(idesco_level_3, 1, 4)
) %>%
# left_join(
#   oja %>%
#     select(
#       idcountry, idesco_level_2, dmax, OJA
#     ),
#   by = c("idcountry", "idesco_level_2", "dmax")
# ) %>%
# filter(!is.na(OJA)) %>% # UK
group_by(dmax, idcountry, idesco_level_2, esco_hier_level_3) %>%
summarise(
mentions = sum(mentions)
) %>%
mutate(
mentions_perc = mentions / sum(mentions)
)
oja_twfe_l3
oja_l3
oja_l3 %>%
group_by(idesco_level_3, dmax) %>%
summarise(
total_oja = sum(OJA)
)
oja_l3 %>%
group_by(idesco_level_3, dmax) %>%
summarise(
total_oja = sum(OJA)
) %>%
ggplot(
aes(x = dmax, y = total_oja, color = idesco_level_3)
) +
geom_line() +
theme_minimal() +
theme(
legend.position = "none"
) +
labs(
x = "Date",
y = "Total OJA"
)
oja_l3
oja_l3 %>%
group_by(idesco_level_1, dmax) %>%
summarise(
total_oja = sum(OJA)
) %>%
ggplot(
aes(x = dmax, y = total_oja, color = idesco_level_1)
) +
geom_line() +
theme_minimal() +
labs(
x = "Date",
y = "Total OJA"
)
oja_l3 %>%
group_by(idesco_level_1, dmax) %>%
summarise(
total_oja = sum(OJA)
) %>%
ggplot(
aes(x = dmax, y = total_oja, color = idesco_level_1)
) +
geom_line() +
theme_minimal() +
scale_color_viridis_d() +
labs(
x = "Date",
y = "Total OJA"
)
oja_l3 %>%
group_by(idesco_level_1, dmax) %>%
summarise(
total_oja = sum(OJA)
) %>%
ggplot(
aes(x = dmax, y = total_oja, color = idesco_level_1)
) +
geom_line() +
theme_minimal() +
scale_color_viridis_d() +
scale_y_continuous(labels = scales::comma) +
labs(
x = "Date",
y = "Total OJA"
)
oja_l3 %>%
group_by(idesco_level_1, dmax) %>%
summarise(
total_oja = sum(OJA)
) %>%
left_join(
bind_rows(
tibble(idesco_level_1 = "OC1", idesco_label = "Managers"),
tibble(idesco_level_1 = "OC2", idesco_label = "Professionals"),
tibble(idesco_level_1 = "OC3", idesco_label = "Technicians and associate professionals"),
tibble(idesco_level_1 = "OC4", idesco_label = "Clerical support workers"),
tibble(idesco_level_1 = "OC5", idesco_label = "Service and sales workers"),
tibble(idesco_level_1 = "OC6", idesco_label = "Skilled agricultural, forestry and fishery workers"),
tibble(idesco_level_1 = "OC7", idesco_label = "Craft and related trades workers"),
tibble(idesco_level_1 = "OC8", idesco_label = "Plant and machine operators, and assemblers"),
tibble(idesco_level_1 = "OC9", idesco_label = "Elementary occupations")
),
by = "idesco_level_1"
)
oja_l3 %>%
group_by(idesco_level_1, dmax) %>%
summarise(
total_oja = sum(OJA)
) %>%
left_join(
bind_rows(
tibble(idesco_level_1 = "OC1", idesco_label = "Managers"),
tibble(idesco_level_1 = "OC2", idesco_label = "Professionals"),
tibble(idesco_level_1 = "OC3", idesco_label = "Technicians and associate professionals"),
tibble(idesco_level_1 = "OC4", idesco_label = "Clerical support workers"),
tibble(idesco_level_1 = "OC5", idesco_label = "Service and sales workers"),
tibble(idesco_level_1 = "OC6", idesco_label = "Skilled agricultural, forestry and fishery workers"),
tibble(idesco_level_1 = "OC7", idesco_label = "Craft and related trades workers"),
tibble(idesco_level_1 = "OC8", idesco_label = "Plant and machine operators, and assemblers"),
tibble(idesco_level_1 = "OC9", idesco_label = "Elementary occupations")
),
by = "idesco_level_1"
) +
ggplot(
aes(x = dmax, y = total_oja, color = idesco_label)
oja_l3 %>%
group_by(idesco_level_1, dmax) %>%
summarise(
total_oja = sum(OJA)
) %>%
left_join(
bind_rows(
tibble(idesco_level_1 = "OC1", idesco_label = "Managers"),
tibble(idesco_level_1 = "OC2", idesco_label = "Professionals"),
tibble(idesco_level_1 = "OC3", idesco_label = "Technicians and associate professionals"),
tibble(idesco_level_1 = "OC4", idesco_label = "Clerical support workers"),
tibble(idesco_level_1 = "OC5", idesco_label = "Service and sales workers"),
tibble(idesco_level_1 = "OC6", idesco_label = "Skilled agricultural, forestry and fishery workers"),
tibble(idesco_level_1 = "OC7", idesco_label = "Craft and related trades workers"),
tibble(idesco_level_1 = "OC8", idesco_label = "Plant and machine operators, and assemblers"),
tibble(idesco_level_1 = "OC9", idesco_label = "Elementary occupations")
),
by = "idesco_level_1"
) +
ggplot(
aes(x = dmax, y = total_oja, color = idesco_label)
) +
geom_line() +
theme_minimal() +
scale_color_viridis_d() +
scale_y_continuous(labels = scales::comma) +
labs(
x = "Date",
y = "Total OJA"
)
oja_l3 %>%
group_by(idesco_level_1, dmax) %>%
summarise(
total_oja = sum(OJA)
) %>%
left_join(
bind_rows(
tibble(idesco_level_1 = "OC1", idesco_label = "Managers"),
tibble(idesco_level_1 = "OC2", idesco_label = "Professionals"),
tibble(idesco_level_1 = "OC3", idesco_label = "Technicians and associate professionals"),
tibble(idesco_level_1 = "OC4", idesco_label = "Clerical support workers"),
tibble(idesco_level_1 = "OC5", idesco_label = "Service and sales workers"),
tibble(idesco_level_1 = "OC6", idesco_label = "Skilled agricultural, forestry and fishery workers"),
tibble(idesco_level_1 = "OC7", idesco_label = "Craft and related trades workers"),
tibble(idesco_level_1 = "OC8", idesco_label = "Plant and machine operators, and assemblers"),
tibble(idesco_level_1 = "OC9", idesco_label = "Elementary occupations")
),
by = "idesco_level_1"
) %>%
ggplot(
aes(x = dmax, y = total_oja, color = idesco_label)
) +
geom_line() +
theme_minimal() +
scale_color_viridis_d() +
scale_y_continuous(labels = scales::comma) +
labs(
x = "Date",
y = "Total OJA"
)
oja_l3 %>%
group_by(idesco_level_1, dmax) %>%
summarise(
total_oja = sum(OJA)
) %>%
left_join(
bind_rows(
tibble(idesco_level_1 = "OC1", idesco_label = "Managers"),
tibble(idesco_level_1 = "OC2", idesco_label = "Professionals"),
tibble(idesco_level_1 = "OC3", idesco_label = "Technicians and associate professionals"),
tibble(idesco_level_1 = "OC4", idesco_label = "Clerical support workers"),
tibble(idesco_level_1 = "OC5", idesco_label = "Service and sales workers"),
tibble(idesco_level_1 = "OC6", idesco_label = "Skilled agricultural, forestry and fishery workers"),
tibble(idesco_level_1 = "OC7", idesco_label = "Craft and related trades workers"),
tibble(idesco_level_1 = "OC8", idesco_label = "Plant and machine operators, and assemblers"),
tibble(idesco_level_1 = "OC9", idesco_label = "Elementary occupations")
),
by = "idesco_level_1"
) %>%
ggplot(
aes(x = dmax, y = total_oja, color = idesco_label)
) +
geom_line() +
theme_minimal() +
scale_color_grey() +
scale_y_continuous(labels = scales::comma) +
labs(
x = "Date",
y = "Total OJA"
)
oja_l3 %>%
group_by(idesco_level_1, dmax) %>%
summarise(
total_oja = sum(OJA)
) %>%
left_join(
bind_rows(
tibble(idesco_level_1 = "OC1", idesco_label = "Managers"),
tibble(idesco_level_1 = "OC2", idesco_label = "Professionals"),
tibble(idesco_level_1 = "OC3", idesco_label = "Technicians and associate professionals"),
tibble(idesco_level_1 = "OC4", idesco_label = "Clerical support workers"),
tibble(idesco_level_1 = "OC5", idesco_label = "Service and sales workers"),
tibble(idesco_level_1 = "OC6", idesco_label = "Skilled agricultural, forestry and fishery workers"),
tibble(idesco_level_1 = "OC7", idesco_label = "Craft and related trades workers"),
tibble(idesco_level_1 = "OC8", idesco_label = "Plant and machine operators, and assemblers"),
tibble(idesco_level_1 = "OC9", idesco_label = "Elementary occupations")
),
by = "idesco_level_1"
) %>%
ggplot(
aes(
x = dmax, y = total_oja, color = idesco_label, lty = idesco_label)
) +
geom_line() +
theme_minimal() +
scale_color_grey() +
scale_y_continuous(labels = scales::comma) +
labs(
x = "Date",
y = "Total OJA"
)
oja_l3 %>%
group_by(idesco_level_1, dmax) %>%
summarise(
total_oja = sum(OJA)
) %>%
left_join(
bind_rows(
tibble(idesco_level_1 = "OC1", idesco_label = "Managers"),
tibble(idesco_level_1 = "OC2", idesco_label = "Professionals"),
tibble(idesco_level_1 = "OC3", idesco_label = "Technicians and associate professionals"),
tibble(idesco_level_1 = "OC4", idesco_label = "Clerical support workers"),
tibble(idesco_level_1 = "OC5", idesco_label = "Service and sales workers"),
tibble(idesco_level_1 = "OC6", idesco_label = "Skilled agricultural, forestry and fishery workers"),
tibble(idesco_level_1 = "OC7", idesco_label = "Craft and related trades workers"),
tibble(idesco_level_1 = "OC8", idesco_label = "Plant and machine operators, and assemblers"),
tibble(idesco_level_1 = "OC9", idesco_label = "Elementary occupations")
),
by = "idesco_level_1"
) %>%
ggplot(
aes(
x = dmax, y = total_oja, color = idesco_label, lty = idesco_label)
) +
geom_line() +
theme_minimal() +
scale_color_grey() +
scale_y_continuous(labels = scales::comma) +
labs(
x = "Date",
y = "Total Online Job Adverts"
) +
ggtitle("Total Online Job Adverts by ISCO Major Group") +
theme(
legend.position = "bottom"
)
oja_l3 %>%
group_by(idesco_level_1, dmax) %>%
summarise(
total_oja = sum(OJA)
) %>%
left_join(
bind_rows(
tibble(idesco_level_1 = "OC1", idesco_label = "Managers"),
tibble(idesco_level_1 = "OC2", idesco_label = "Professionals"),
tibble(idesco_level_1 = "OC3", idesco_label = "Technical professionals"),
tibble(idesco_level_1 = "OC4", idesco_label = "Clerical support workers"),
tibble(idesco_level_1 = "OC5", idesco_label = "Service and sales workers"),
tibble(idesco_level_1 = "OC6", idesco_label = "Agricultural workers"),
tibble(idesco_level_1 = "OC7", idesco_label = "Craft and trades workers"),
tibble(idesco_level_1 = "OC8", idesco_label = "Plant and machine operators"),
tibble(idesco_level_1 = "OC9", idesco_label = "Elementary occupations")
),
by = "idesco_level_1"
) %>%
ggplot(
aes(
x = dmax, y = total_oja, color = idesco_label, lty = idesco_label)
) +
geom_line() +
theme_minimal() +
scale_color_grey() +
scale_y_continuous(labels = scales::comma) +
labs(
x = "Date",
y = "Total Online Job Adverts"
) +
ggtitle("Total Online Job Adverts by ISCO Major Group") +
theme(
legend.position = "bottom"
)
oja_l3 %>%
group_by(idesco_level_1, dmax) %>%
summarise(
total_oja = sum(OJA)
) %>%
left_join(
bind_rows(
tibble(idesco_level_1 = "OC1", idesco_label = "Managers"),
tibble(idesco_level_1 = "OC2", idesco_label = "Professionals"),
tibble(idesco_level_1 = "OC3", idesco_label = "Technical professionals"),
tibble(idesco_level_1 = "OC4", idesco_label = "Clerical support workers"),
tibble(idesco_level_1 = "OC5", idesco_label = "Service and sales workers"),
tibble(idesco_level_1 = "OC6", idesco_label = "Agricultural workers"),
tibble(idesco_level_1 = "OC7", idesco_label = "Craft and trades workers"),
tibble(idesco_level_1 = "OC8", idesco_label = "Plant and machine operators"),
tibble(idesco_level_1 = "OC9", idesco_label = "Elementary occupations")
),
by = "idesco_level_1"
) %>%
ggplot(
aes(
x = dmax, y = total_oja, color = idesco_label, lty = idesco_label)
) +
geom_line() +
theme_minimal() +
scale_color_grey() +
scale_y_continuous(labels = scales::comma) +
labs(
x = "Date",
y = "Total Online Job Adverts"
) +
ggtitle("Total Online Job Adverts by ISCO Major Group")
oja_l3 %>%
group_by(idesco_level_1, dmax) %>%
summarise(
total_oja = sum(OJA)
) %>%
left_join(
bind_rows(
tibble(idesco_level_1 = "OC1", idesco_label = "Managers"),
tibble(idesco_level_1 = "OC2", idesco_label = "Professionals"),
tibble(idesco_level_1 = "OC3", idesco_label = "Technical professionals"),
tibble(idesco_level_1 = "OC4", idesco_label = "Clerical support workers"),
tibble(idesco_level_1 = "OC5", idesco_label = "Service and sales workers"),
tibble(idesco_level_1 = "OC6", idesco_label = "Agricultural workers"),
tibble(idesco_level_1 = "OC7", idesco_label = "Craft and trades workers"),
tibble(idesco_level_1 = "OC8", idesco_label = "Plant and machine operators"),
tibble(idesco_level_1 = "OC9", idesco_label = "Elementary occupations")
),
by = "idesco_level_1"
) %>%
ggplot(
aes(
x = dmax, y = total_oja, color = idesco_label, lty = idesco_label)
) +
geom_line() +
theme_minimal() +
scale_color_grey() +
scale_y_continuous(labels = scales::comma) +
labs(
x = "Date",
y = "Total Online Job Adverts"
) +
ggtitle("Total Online Job Adverts by ISCO Major Group") -> p
library(plotly)
install.packages("plotly")
ggplotly(p)
library(plotly)
ggplotly(p)
oja_l3 %>%
group_by(idesco_level_1, dmax) %>%
summarise(
total_oja = sum(OJA)
)
oja_l3 %>%
group_by(idesco_level_1, dmax) %>%
summarise(
total_oja = sum(OJA)
) %>% filter(dmax == min(dmax))
oja_l3 %>%
group_by(idesco_level_1, dmax) %>%
summarise(
total_oja = sum(OJA)
) %>% filter(dmax == max(dmax))
oja_l3 %>%
group_by(idesco_level_1, dmax) %>%
summarise(
total_oja = sum(OJA)
) %>% filter(dmax == min(dmax)) -> TT1
oja_l3 %>%
group_by(idesco_level_1, dmax) %>%
summarise(
total_oja = sum(OJA)
) %>% filter(dmax == max(dmax)) -> TT2
TT1$total_oja / TT2$total_oja
